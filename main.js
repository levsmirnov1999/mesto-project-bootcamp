(()=>{"use strict";function e(e){var t=e.formSelector,n=e.inputSelector,o=e.submitButtonSelector,r=e.inactiveButtonClass,c=e.inputErrorClass,u=e.errorClass,i=document.querySelector(t),a=i.querySelectorAll(n),l=(i.querySelector(u),i.querySelector(o));function s(e){var t,n=e.target;n.validity.valid?function(e){i.querySelector("".concat(u,"-").concat(e.name)).textContent="",e.classList.remove(c)}(n):function(e){var t="".concat(u,"-").concat(e.name);i.querySelector(t).textContent=e.validationMessage,e.classList.add(c)}(n),t=i.checkValidity(),l.disabled=!t,l.classList.toggle(r,!t)}a.forEach((function(e){e.addEventListener("input",s)}))}var t=document.querySelector(".profile__edit-button"),n=document.querySelector(".popup_edit-profile"),o=document.querySelector(".popup__close-icon_place_edit-profile"),r=document.querySelector(".profile__add-button"),c=document.querySelector(".popup_add-item"),u=document.querySelector(".popup__close-icon_place_add-item"),i=document.querySelector(".popup_image"),a=document.querySelector(".popup__close-icon_place_image"),l=document.querySelector(".popup__image"),s=document.querySelector(".popup__description"),p=document.querySelector(".popup__form_place_edit-profile"),d=document.querySelector(".popup__input_profile_name"),_=document.querySelector(".popup__input_profile_about-me"),f=document.querySelector(".popup__save-button_place_edit-profile"),m=document.querySelector(".profile__name"),v=document.querySelector(".profile__about-me"),h=document.querySelector(".profile__avatar"),y=document.querySelector(".profile__avatar-edit"),S=document.querySelector(".popup_edit-avatar"),b=document.querySelector(".popup__close-icon_place_edit-avatar"),q=document.querySelector(".popup__form_place_edit-avatar"),E=document.querySelector(".popup__input_edit-avatar_link"),k=document.querySelector(".popup__save-button_place_edit-avatar");function g(){h.setAttribute("src",E.value)}function C(e){e.classList.add("popup_opened"),document.addEventListener("keydown",(function t(n){"Escape"===n.key&&(L(e),document.removeEventListener("keydown",t))}))}function L(e){e.classList.remove("popup_opened"),e.querySelectorAll(".popup__input").forEach((function(e){e.value=""}))}function w(e,t){t.target.classList.contains("popup")&&L(e)}var x,A={baseUrl:"https://nomoreparties.co/v1/wbf-cohort-10",headers:{authorization:"08a9e413-f3a2-4906-808f-70fe33826b1a","Content-Type":"application/json"}};function T(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,o=new Array(t);n<t;n++)o[n]=e[n];return o}var U=document.querySelector(".popup__form_place_add-item"),j=document.querySelector(".popup__input_new-item_title"),B=document.querySelector(".popup__input_new-item_link"),O=document.querySelector(".popup__save-button_place_add-item"),D=document.querySelector(".elements");function N(e){var t=document.querySelector("#card-template").content.querySelector(".elements__card").cloneNode(!0);t.querySelector(".elements__title").textContent=e.name,t.querySelector(".elements__photo").setAttribute("src",e.link);var n=t.querySelector(".elements__like-button"),o=t.querySelector(".elements__like-counter");n.addEventListener("click",(function(t){var n;t.target.classList.toggle("elements__like-button_active"),t.target.classList.contains("elements__like-button_active")?(n=e._id,fetch("".concat(A.baseUrl,"/cards/likes/").concat(n),{method:"PUT",headers:A.headers}).then((function(e){if(e.ok)return e.json();throw new Error("Ошибка")})).catch((function(e){console.log("Произошла ошибка:",e)}))).then((function(e){u(e.likes.length)})):function(e){return fetch("".concat(A.baseUrl,"/cards/likes/").concat(e),{method:"DELETE",headers:A.headers}).then((function(e){if(e.ok)return e.json();throw new Error("Ошибка")})).catch((function(e){console.log("Произошла ошибка:",e)}))}(e._id).then((function(e){u(e.likes.length)}))}));var r,c=function(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return T(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?T(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var o=0,r=function(){};return{s:r,n:function(){return o>=e.length?{done:!0}:{done:!1,value:e[o++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var c,u=!0,i=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return u=e.done,e},e:function(e){i=!0,c=e},f:function(){try{u||null==n.return||n.return()}finally{if(i)throw c}}}}(e.likes);try{for(c.s();!(r=c.n()).done;)r.value._id===x&&n.classList.toggle("elements__like-button_active")}catch(e){c.e(e)}finally{c.f()}function u(e){o.textContent=e}return e.owner._id===x&&(t.querySelector(".elements__delete-icon").classList.add("elements__delete-icon_hidden"),t.querySelector(".elements__delete-icon").addEventListener("click",(function(t){var n;(n=e._id,fetch("".concat(A.baseUrl,"/cards/").concat(n),{method:"DELETE",headers:A.headers}).then((function(e){e.ok?console.log("Карточка успешно удалена"):console.log("Ошибка при удалении карточки")})).catch((function(e){console.log("Произошла ошибка:",e)}))).then((function(){return t.target.parentNode.remove()}))}))),t.querySelector(".elements__photo").addEventListener("click",(function(){C(i),s.textContent=e.name,l.setAttribute("src",e.link)})),u(e.likes.length),D.prepend(t),t}n.addEventListener("click",(function(e){w(n,e)})),c.addEventListener("click",(function(e){w(c,e)})),i.addEventListener("click",(function(e){w(i,e)})),S.addEventListener("click",(function(e){w(S,e)})),t.addEventListener("click",(function(){d.value=m.textContent,_.value=v.textContent,C(n)})),o.addEventListener("click",(function(){return L(n)})),r.addEventListener("click",(function(){return C(c)})),u.addEventListener("click",(function(){return L(c)})),a.addEventListener("click",(function(){return L(i)})),y.addEventListener("click",(function(){return C(S)})),b.addEventListener("click",(function(){return L(S)})),q.addEventListener("submit",(function(e){var t;e.preventDefault(),k.textContent="Сохранение…",(t=E.value,fetch("".concat(A.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:A.headers,body:JSON.stringify({avatar:t})})).then((function(e){g()})),setTimeout((function(){O.textContent="Сохранить",L(S)}),800)})),p.addEventListener("submit",(function(e){var t,o;e.preventDefault(),f.textContent="Сохранение",(t=d.value,o=_.value,fetch("".concat(A.baseUrl,"/users/me"),{method:"PATCH",headers:A.headers,body:JSON.stringify({name:t,about:o})}).then((function(e){if(e.ok)return e.json();throw new Error("Ошибка")}))).then((function(e){m.textContent=d.value,v.textContent=_.value})),setTimeout((function(){O.textContent="Сохранить",L(n)}),800)})),U.addEventListener("submit",(function(e){var t,n;e.preventDefault(),O.textContent="Создаем…",(t=j.value,n=B.value,fetch("".concat(A.baseUrl,"/cards"),{method:"POST",headers:A.headers,body:JSON.stringify({name:t,link:n})}).then((function(e){if(e.ok)return e.json();throw new Error("Ошибка")}))).then((function(e){!function(e){N(e)}(e)})),setTimeout((function(){O.textContent="Создать",L(c)}),800)})),U.addEventListener("submit",(function(){U.reset()})),e({formSelector:".popup__form_place_edit-profile",inputSelector:".popup__input",errorClass:".popup__input-error",submitButtonSelector:".popup__save-button",inactiveButtonClass:"popup__save-button_disabled",inputErrorClass:"popup__input_invalid"}),e({formSelector:".popup__form_place_add-item",inputSelector:".popup__input",errorClass:".popup__input-error",submitButtonSelector:".popup__save-button",inactiveButtonClass:"popup__save-button_disabled",inputErrorClass:"popup__input_invalid"}),e({formSelector:".popup__form_place_edit-avatar",inputSelector:".popup__input",errorClass:".popup__input-error",submitButtonSelector:".popup__save-button",inactiveButtonClass:"popup__save-button_disabled",inputErrorClass:"popup__input_invalid"}),fetch("".concat(A.baseUrl,"/users/me"),{headers:A.headers}).then((function(e){if(e.ok)return e.json();throw new Error("Ошибка")})).then((function(e){x=e._id,m.textContent=e.name,v.textContent=e.about,h.src=e.avatar})).catch((function(e){console.log("Произошла ошибка:",e)})),fetch("".concat(A.baseUrl,"/cards"),{headers:A.headers}).then((function(e){if(e.ok)return e.json();throw new Error("Ошибка")})).then((function(e){var t=e;console.log(e),t.forEach((function(e){N(e)}))})).catch((function(e){console.log("Произошла ошибка:",e)}))})();